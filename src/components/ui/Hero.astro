---
import SocialIcons from './SocialIcons.astro'
import { profile } from '../../settings'

const {fullName, title, institute} = Astro.props
// Use profilepic2.png for the hero section
const heroProfilePicture = '/images/profilepic2.png'
---
<div class='flex-1 order-2 lg:order-1 relative'>
  <h1 class='text-2xl sm:text-3xl lg:text-4xl font-bold mb-4 name-title-text' style="font-family: 'Orbitron', sans-serif;">
    <span id="cipher-name" data-final-text={fullName} class="inline-block" style="font-family: 'Orbitron', sans-serif;">{fullName}</span>
  </h1>
  
  <!-- Multilingual Names -->
  <div class='mb-4 space-y-2' style="font-family: ui-sans-serif, system-ui, sans-serif;">
    <div class='flex flex-col sm:flex-row sm:flex-wrap gap-2 sm:gap-4 text-sm'>
      <div class='flex items-center gap-2 bg-base-200/50 px-3 py-2 rounded-lg backdrop-blur-sm transition-all duration-300 hover:bg-base-200/80 hover:scale-105'>
        <span class='text-primary font-medium'>English:</span>
        <span id="cipher-name-en" data-final-text={profile.namesMultilingual.english} class='text-base-content font-bold font-mono'>{profile.namesMultilingual.english}</span>
      </div>
      <div class='flex items-center gap-2 bg-base-200/50 px-3 py-2 rounded-lg backdrop-blur-sm transition-all duration-300 hover:bg-base-200/80 hover:scale-105'>
        <span class='text-primary font-medium'>فارسی:</span>
        <span id="cipher-name-fa" data-final-text={profile.namesMultilingual.persian} class='text-base-content font-bold font-mono' dir='rtl'>{profile.namesMultilingual.persian}</span>
      </div>
      <div class='flex items-center gap-2 bg-base-200/50 px-3 py-2 rounded-lg backdrop-blur-sm transition-all duration-300 hover:bg-base-200/80 hover:scale-105'>
        <span class='text-primary font-medium'>中文:</span>
        <span id="cipher-name-zh" data-final-text={profile.namesMultilingual.chinese} class='text-base-content font-bold font-mono'>{profile.namesMultilingual.chinese}</span>
      </div>
    </div>
  </div>
  
  <p class='text-lg sm:text-xl text-base-content/80 mb-4 font-medium' style="font-family: 'Exo 2', sans-serif;">{title}{institute ? ` at ${institute}` : ''}</p>
  <div class='bg-base-200/30 backdrop-blur-sm rounded-2xl p-6 mb-6 border border-base-300/50 transition-all duration-300 hover:bg-base-200/50 hover:border-base-300/80'>
    <p class='text-sm sm:text-base lg:text-lg leading-relaxed text-base-content/90' style="font-family: 'Quantico', sans-serif;">
      I am interested in mathematics, logic, and computer science. 
      I love finding connections between different mathematical problems and applying advances from one area to solve challenges in another. 
      My academic background spans mathematics and electronic engineering (two bachelor's degrees) from <a href="https://en.kntu.ac.ir/" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">K. N. Toosi University</a>, followed by a master's degree in mathematics at the <a href="https://ut.ac.ir/en" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">University of Tehran</a>. 
      I completed my Ph.D. in computer science with distinction at <a href="https://www.tugraz.at/en/home/" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">Graz University of Technology</a> in 2024, specializing in cryptography. 
      I am now a postdoctoral researcher at <a href="https://www.ruhr-uni-bochum.de/en" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">Ruhr University Bochum</a>, continuing my research in cryptanalysis of symmetric-key primitives. 
      I have published papers in top conferences/journals including <a href="https://crypto.iacr.org/" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">CRYPTO</a>, <a href="https://eurocrypt.iacr.org/" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">EUROCRYPT</a>, <a href="https://fse.iacr.org/" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">FSE</a>/<a href="https://tosc.iacr.org/" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">ToSC</a>, and <a href="https://ches.iacr.org/" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-secondary transition-colors duration-300 hover:underline font-medium">CHES</a>.
    </p>
  </div>
  <div class='bg-base-200/30 backdrop-blur-sm rounded-lg p-3 mb-4 border border-base-300/50 transition-all duration-300 hover:bg-base-200/50'>
    <p class='text-xs overflow-x-auto' style="font-family: 'Quantico', sans-serif;">
      <span class='text-primary font-medium'>Public key:</span> 
      <span class='break-all text-base-content/80 font-mono'>age17x6fu4na8hvxuh7hgs7ec62g7ddhsdlasqrqe6u7pzx0z86fpsxsgfpwdp</span>
    </p>
  </div>
  <div class='flex gap-4'>
    <SocialIcons />
  </div>
</div>
<div class='w-48 h-48 sm:w-56 sm:h-56 lg:w-72 lg:h-72 mx-auto lg:mx-0 order-1 lg:order-2 flex-shrink-0 group'>
  <!-- Add your profile image with enhanced styling -->
  <div class='relative w-full h-full'>
    <div class='absolute inset-0 bg-teal-600 dark:bg-cyan-500 rounded-full p-1 transition-all duration-300 group-hover:scale-105 group-hover:rotate-1'>
      <div class='w-full h-full bg-base-100 rounded-full p-1'>
        <img
          src={heroProfilePicture}
          alt={fullName}
          class='mask mask-circle object-cover w-full h-full transition-all duration-300 group-hover:scale-105'
        />
      </div>
    </div>
    <!-- Subtle glow effect -->
    <div class='absolute inset-0 bg-teal-600/20 dark:bg-cyan-500/20 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 blur-xl -z-10'></div>
  </div>
</div>

<script>
  // Cipher rotor animation for names
  function initCipherAnimation() {
    // Character sets for different languages (letters only)
    const charSets = {
      latinUpper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      latinLower: 'abcdefghijklmnopqrstuvwxyz',
      persian: 'ابپتثجچحخدذرزژسشصضطظعغفقکگلمنوهی',
      chinese: '密码学安全加解锁钥匙算法数据信息网络系统程序代码研究'
    };
    
    // Helper function to get appropriate charset for a character
    function getCharsetForChar(char, charset) {
      if (charset === 'latin') {
        // Match the case of the final character
        if (char === char.toUpperCase() && char !== char.toLowerCase()) {
          return charSets.latinUpper;
        } else {
          return charSets.latinLower;
        }
      } else if (charset === 'persian') {
        return charSets.persian;
      } else if (charset === 'chinese') {
        return charSets.chinese;
      }
      return charSets.latinLower;
    }
    
    // Animation configuration for each element
    const elements = [
      { id: 'cipher-name', charset: 'latin', delay: 200 },
      { id: 'cipher-name-en', charset: 'latin', delay: 400 },
      { id: 'cipher-name-fa', charset: 'persian', delay: 600, rtl: true },
      { id: 'cipher-name-zh', charset: 'chinese', delay: 800 }
    ];
    
    elements.forEach(config => {
      const element = document.getElementById(config.id);
      if (!element) return;
      
      const finalText = element.dataset.finalText || '';
      if (!finalText) return;
      
      // Animation settings
      const totalDuration = 2500;
      const frameRate = 50;
      const frames = totalDuration / frameRate;
      
      // Track which characters are "locked"
      const locked = new Array(finalText.length).fill(false);
      let currentText = new Array(finalText.length).fill('');
      
      // Initialize with random characters (preserve spaces, match case)
      for (let i = 0; i < finalText.length; i++) {
        if (finalText[i] === ' ') {
          currentText[i] = ' ';
          locked[i] = true;
        } else {
          const chars = getCharsetForChar(finalText[i], config.charset);
          currentText[i] = chars[Math.floor(Math.random() * chars.length)];
        }
      }
      
      element.textContent = currentText.join('');
      
      let frame = 0;
      
      const animate = () => {
        frame++;
        
        const progress = frame / frames;
        const charsToLock = Math.floor(progress * finalText.length);
        
        for (let i = 0; i < finalText.length; i++) {
          if (locked[i]) continue;
          
          if (i < charsToLock) {
            currentText[i] = finalText[i];
            locked[i] = true;
          } else {
            if (Math.random() > 0.3) {
              const chars = getCharsetForChar(finalText[i], config.charset);
              currentText[i] = chars[Math.floor(Math.random() * chars.length)];
            }
          }
        }
        
        element.textContent = currentText.join('');
        
        if (frame < frames) {
          setTimeout(animate, frameRate);
        } else {
          element.textContent = finalText;
          element.classList.remove('font-mono');
        }
      };
      
      // Start animation with staggered delay
      setTimeout(animate, config.delay);
    });
  }
  
  // Run animation - handle various loading scenarios for mobile compatibility
  function runAnimation() {
    // Small delay to ensure DOM is ready
    setTimeout(initCipherAnimation, 50);
  }
  
  // Try multiple approaches for mobile compatibility
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', runAnimation);
  } else {
    // DOM already loaded
    runAnimation();
  }
  
  // Also run on Astro page transitions (for SPA navigation)
  document.addEventListener('astro:page-load', runAnimation);
</script>