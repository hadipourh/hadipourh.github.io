---
import Layout from '@/layouts/Layout.astro'
import {template} from '@/settings'
import {getCollection, render} from 'astro:content'

export async function getStaticPaths(): Promise<Array<{ params: { slug: string }, props: { post: any } }>> {
    const blogEntries = await getCollection("blog");

    const posts = blogEntries
        .map(post => {
        const slug = post.id
            return {
            params: { slug },
            props: { post },
            }
    })
    return posts
}
const {post} = Astro.props;
const { title, date, tags} = post.data; 
const { Content } = await render(post);
---

<Layout title={title}>
	<div class='w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8'>
		<article
			class='prose w-full max-w-full prose-headings:text-base-content prose-p:text-base-content/80 prose-sm sm:prose-base lg:prose-lg overflow-hidden'
		>
			<!-- Header section -->
			<div class='mb-6 sm:mb-8 border-b pb-6 sm:pb-8'>
				<h1 class='text-2xl sm:text-3xl lg:text-4xl font-bold mb-3 sm:mb-4 text-base-content'>{title}</h1>
				<div class='flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-2 sm:gap-4 text-base-content/70'>
					<!-- Date -->
					<time datetime={date} class='flex items-center text-xs sm:text-sm'>
						<svg
							xmlns='http://www.w3.org/2000/svg'
							class='h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2'
							fill='none'
							viewBox='0 0 24 24'
							stroke='currentColor'
						>
							<path
								stroke-linecap='round'
								stroke-linejoin='round'
								stroke-width='2'
								d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'
							></path>
						</svg>
						{
							new Date(date).toLocaleDateString('en-US', {
								year: 'numeric',
								month: 'long',
								day: 'numeric',
							})
						}
					</time>

					<!-- Tags -->
					{
						tags && (
							<div class='flex flex-wrap gap-1 sm:gap-2'>
								{tags.map(tag => (
									<span class='badge badge-accent badge-outline text-xs'>{tag}</span>
								))}
							</div>
						)
					}
				</div>
			</div>

			<!-- Post content -->
			<div
			class='prose mt-6 sm:mt-8 prose-sm sm:prose-base lg:prose-lg
		 prose-h2:text-xl sm:prose-h2:text-2xl prose-h2:font-bold prose-h2:mb-3 sm:prose-h2:mb-4
		 prose-h3:text-lg sm:prose-h3:text-xl prose-h3:font-semibold prose-h3:mb-2 sm:prose-h3:mb-3
		 prose-p:mb-3 sm:prose-p:mb-4 prose-p:leading-relaxed
		 prose-strong:text-base-content prose-strong:font-bold
		 prose-em:italic
		 prose-a:text-accent prose-a:no-underline hover:prose-a:underline
		 prose-code:text-base-content prose-code:text-xs sm:prose-code:text-sm
		 prose-pre:rounded-xl prose-pre:shadow-sm prose-pre:p-4 sm:prose-pre:p-5 prose-pre:overflow-x-auto prose-pre:font-mono
		 prose-blockquote:border-l-4 prose-blockquote:border-accent prose-blockquote:pl-3 sm:prose-blockquote:pl-4 prose-blockquote:italic
		 prose-ul:list-disc prose-ul:pl-4 sm:prose-ul:pl-6 prose-ul:my-2 sm:prose-ul:my-3
		 prose-ol:list-decimal prose-ol:pl-4 sm:prose-ol:pl-6 prose-ol:my-2 sm:prose-ol:my-3
		 prose-li:mb-0.5 sm:prose-li:mb-1
		 prose-img:rounded-lg prose-img:my-4 sm:prose-img:my-8 prose-img:w-full'
		>
                <Content />
			</div>
		</article>
	</div>
</Layout>

<style>
	/* Avoid double background/padding for code inside pre blocks */
	.prose pre code {
		background: transparent;
		padding: 0;
		color: inherit;
		box-shadow: none;
	}

	/* Remove decorative backticks around inline code from typography plugin */
	.prose :not(pre) > code::before,
	.prose :not(pre) > code::after {
		content: none;
	}

	/* Ensure inline code has no background in both themes */
	.prose :not(pre) > code {
		background: transparent;
	}

		/* Improve contrast for ASCII diagrams and messages in light mode */
		[data-theme="light"] .prose pre {
			background-color: hsl(var(--b1)); /* base-100 */
			border-color: hsl(var(--b3));     /* base-300 */
				color: hsl(var(--bc));            /* base-content */
		}

		/* And in dark mode keep a faint panel look for readability */
		[data-theme="dark"] .prose pre {
			background-color: hsl(var(--b2)); /* base-200 */
			border-color: hsl(var(--b3));     /* base-300 */
				color: hsl(var(--bc));            /* base-content */
		}

			/* Ensure nested code inherits the same high-contrast color */
			[data-theme="light"] .prose pre code,
			[data-theme="dark"] .prose pre code {
				color: hsl(var(--bc));
			}

</style>
