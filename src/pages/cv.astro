---
import Layout from '@/layouts/Layout.astro'
import { experiences, education, skills, publications, teaching, presentations, reviews, honors, conferences, memberships, interests } from '../data/cv'
import CvTimeline from '@/components/ui/CvTimeline.astro'

import type { Experience, Education, Publication } from '../types/cv'
import List from '@/components/ui/List.astro'
import PublicationsList from '@/components/ui/PublicationsList.astro'

let orderdExperiences: Experience[] = []
let orderdEducations: Education[] = []
let orderedPublications: Publication[] = []

const orderElement = <T extends { time: string }>(a: T, b: T) => {
  const presentValues = ['present', 'now', 'current', 'today']
  if (
			presentValues.includes(
				(a['time'] as string)?.split(' - ')[1]?.toLowerCase()
			)
		) {
			// If the date is 'present', it should be the first element
			return -1
		}
		const dateA = new Date((a['time'] as string)?.split(' - ')[1])
		const dateB = new Date((b['time'] as string)?.split(' - ')[1])
		return dateB.getTime() - dateA.getTime()
}

if (experiences.length > 0) {
	orderdExperiences = experiences.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (education.length > 0) {
	orderdEducations = education.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (publications.length > 0) {
	orderedPublications = publications.sort((a, b) => {
		return orderElement(a, b)
	})
}
---

<Layout>
	<!-- CV Header with Download Link -->
	<section class='mb-12'>
		<div class='flex justify-between items-center mb-8'>
			<h1 class='text-4xl font-bold'>Curriculum Vitae</h1>
			<a 
				href='/cv/CV.pdf' 
				download='Hosein_Hadipour_CV.pdf'
				class='btn btn-primary gap-2'
				target='_blank'
			>
				<svg class='w-4 h-4' fill='currentColor' viewBox='0 0 20 20'>
					<path fill-rule='evenodd' d='M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z' clip-rule='evenodd'></path>
				</svg>
				Download PDF
			</a>
		</div>
		<p class='text-lg text-gray-600'>
			Postdoctoral Researcher specializing in cryptanalysis of symmetric-key primitives and automated security analysis at Ruhr University Bochum.
		</p>
	</section>

	{
		orderdEducations.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Education
				</h2>
				<CvTimeline elements={orderdEducations} colored={true} />
			</section>
		)
	}

	{
		orderdExperiences.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Experiences
				</h2>
				<CvTimeline elements={orderdExperiences} colored={true} />
			</section>
		)
	}

	{
		orderdEducations.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Last publications
				</h2>
				<PublicationsList elements={orderedPublications}/>
			</section>
		)
	}

	{
		skills.length > 0 && (
			<section class='mb-12'>
				<List listTitle='Skills' listItems={skills}/>
			</section>
		)
	}

	{
		teaching.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Teaching Experience
				</h2>
				<div class='space-y-4'>
					{teaching.map((item) => (
						<div class='border-l-2 border-primary pl-4'>
							<h3 class='text-lg font-semibold'>{item.course}</h3>
							<p class='text-primary font-medium'>{item.role} at {item.institution}</p>
							<p class='text-sm text-gray-600'>{item.time}</p>
							{item.description && <p class='text-sm mt-2'>{item.description}</p>}
						</div>
					))}
				</div>
			</section>
		)
	}

	{
		presentations.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Presentations & Visits
				</h2>
				<div class='space-y-3'>
					{presentations.map((item) => (
						<div class='flex justify-between items-start'>
							<div>
								<h3 class='font-medium'>{item.title}</h3>
								<p class='text-sm text-gray-600'>{item.location}</p>
							</div>
							<div class='text-right'>
								<p class='text-sm text-primary'>{item.type}</p>
								<p class='text-sm text-gray-500'>{item.time}</p>
							</div>
						</div>
					))}
				</div>
			</section>
		)
	}

	{
		reviews.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Academic Reviews
				</h2>
				<div class='grid grid-cols-1 md:grid-cols-2 gap-3'>
					{reviews.map((item) => (
						<div class='flex justify-between items-center p-3 bg-base-200 rounded'>
							<span class='font-medium'>{item.title}</span>
							<div class='text-right'>
								<p class='text-sm text-primary'>{item.description}</p>
								<p class='text-xs text-gray-500'>{item.time}</p>
							</div>
						</div>
					))}
				</div>
			</section>
		)
	}

	{
		honors.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Honors & Awards
				</h2>
				<div class='space-y-4'>
					{honors.map((item) => (
						<div class='border-l-2 border-secondary pl-4'>
							<h3 class='text-lg font-semibold text-secondary'>{item.title}</h3>
							<p class='text-sm text-gray-600'>{item.description}</p>
							<p class='text-xs text-gray-500'>{item.time}</p>
						</div>
					))}
				</div>
			</section>
		)
	}

	{
		conferences.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Conference & Workshop Attendance
				</h2>
				<div class='space-y-3'>
					{conferences.map((item) => (
						<div class='flex justify-between items-start p-3 bg-base-100 border rounded'>
							<div>
								<h3 class='font-medium'>{item.title}</h3>
								<p class='text-sm text-gray-600'>{item.location}</p>
							</div>
							<div class='text-right'>
								<p class='text-sm text-primary font-medium'>{item.role}</p>
								<p class='text-sm text-gray-500'>{item.time}</p>
							</div>
						</div>
					))}
				</div>
			</section>
		)
	}

	{
		memberships.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Professional Memberships
				</h2>
				<div class='space-y-4'>
					{memberships.map((item) => (
						<div class='border-l-2 border-accent pl-4'>
							<h3 class='text-lg font-semibold'>{item.title}</h3>
							<p class='text-sm text-accent font-medium'>{item.time}</p>
							<p class='text-sm text-gray-600 mt-1'>{item.description}</p>
						</div>
					))}
				</div>
			</section>
		)
	}

	{
		interests.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Personal Interests
				</h2>
				<div class='grid grid-cols-1 md:grid-cols-2 gap-4'>
					{interests.map((item) => (
						<div class='p-4 bg-base-200 rounded-lg'>
							<h3 class='font-semibold text-primary mb-2'>{item.title}</h3>
							<p class='text-sm text-gray-600'>{item.description}</p>
						</div>
					))}
				</div>
			</section>
		)
	}
</Layout>
